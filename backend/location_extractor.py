# Lista de ciudades españolas comunes con sus coordenadas
SPANISH_CITIES = {
    "madrid": {"lat": 40.4168, "lng": -3.7038},
    "barcelona": {"lat": 41.3851, "lng": 2.1734},
    "valencia": {"lat": 39.4699, "lng": -0.3763},
    "sevilla": {"lat": 37.3891, "lng": -5.9845},
    "zaragoza": {"lat": 41.6488, "lng": -0.8891},
    "málaga": {"lat": 36.7213, "lng": -4.4214},
    "murcia": {"lat": 37.9922, "lng": -1.1307},
    "palma": {"lat": 39.5696, "lng": 2.6502},
    "bilbao": {"lat": 43.2630, "lng": -2.9350},
    "alicante": {"lat": 38.3452, "lng": -0.4810},
    "córdoba": {"lat": 37.8882, "lng": -4.7794},
    "valladolid": {"lat": 41.6528, "lng": -4.7245},
    "vigo": {"lat": 42.2406, "lng": -8.7207},
    "gijón": {"lat": 43.5322, "lng": -5.6611},
    "hospitalet": {"lat": 41.3598, "lng": 2.1000},
    "vitoria": {"lat": 42.8467, "lng": -2.6716},
    "granada": {"lat": 37.1773, "lng": -3.5986},
    "oviedo": {"lat": 43.3614, "lng": -5.8493},
    "badalona": {"lat": 41.4501, "lng": 2.2460},
    "cartagena": {"lat": 37.6256, "lng": -0.9960},
    "terrassa": {"lat": 41.5644, "lng": 2.0110},
    "jerez": {"lat": 36.6868, "lng": -6.1264},
    "sabadell": {"lat": 41.5433, "lng": 2.1082},
    "móstoles": {"lat": 40.3229, "lng": -3.8652},
    "alcalá": {"lat": 40.4818, "lng": -3.3634},
    "pamplona": {"lat": 42.8125, "lng": -1.6458},
    "fuenlabrada": {"lat": 40.2842, "lng": -3.7947},
    "almería": {"lat": 36.8340, "lng": -2.4637},
    "leganés": {"lat": 40.3276, "lng": -3.7636},
    "santander": {"lat": 43.4623, "lng": -3.8100},
    "burgos": {"lat": 42.3439, "lng": -3.6969},
    "castellón": {"lat": 39.9864, "lng": -0.0513},
    "getafe": {"lat": 40.3057, "lng": -3.7329},
    "albacete": {"lat": 38.9943, "lng": -1.8585},
    "alcorcón": {"lat": 40.3457, "lng": -3.8245},
    "toledo": {"lat": 39.8628, "lng": -4.0273},
    "salamanca": {"lat": 40.9701, "lng": -5.6635},
    "logroño": {"lat": 42.4627, "lng": -2.4450},
    "badajoz": {"lat": 38.8794, "lng": -6.9707},
    "huelva": {"lat": 37.2614, "lng": -6.9447},
    "tarragona": {"lat": 41.1189, "lng": 1.2445},
    "lleida": {"lat": 41.6176, "lng": 0.6200},
    "león": {"lat": 42.5987, "lng": -5.5671},
    "cádiz": {"lat": 36.5271, "lng": -6.2886},
    "jaén": {"lat": 37.7796, "lng": -3.7849},
    "ourense": {"lat": 42.3406, "lng": -7.8640},
    "lugo": {"lat": 43.0097, "lng": -7.5567},
    "girona": {"lat": 41.9794, "lng": 2.8214},
    "santiago": {"lat": 42.8782, "lng": -8.5448},
    "cáceres": {"lat": 39.4753, "lng": -6.3724},
    "lorca": {"lat": 37.6773, "lng": -1.7006},
    "europa": {"lat": 50.8503, "lng": 4.3517},  # Bruselas como centro de Europa
    "estados unidos": {"lat": 38.9072, "lng": -77.0369},  # Washington DC
    "eeuu": {"lat": 38.9072, "lng": -77.0369},
    "washington": {"lat": 38.9072, "lng": -77.0369},
    "gaza": {"lat": 31.5017, "lng": 34.4668},
    "israel": {"lat": 31.7683, "lng": 35.2137},  # Jerusalén
    "jerusalén": {"lat": 31.7683, "lng": 35.2137},
    "ucrania": {"lat": 50.4501, "lng": 30.5234},  # Kiev
    "rusia": {"lat": 55.7558, "lng": 37.6173},  # Moscú
    "moscú": {"lat": 55.7558, "lng": 37.6173},
    "kiev": {"lat": 50.4501, "lng": 30.5234},
    "parís": {"lat": 48.8566, "lng": 2.3522},
    "londres": {"lat": 51.5074, "lng": -0.1278},
    "berlín": {"lat": 52.5200, "lng": 13.4050},
    "roma": {"lat": 41.9028, "lng": 12.4964},
    "lisboa": {"lat": 38.7223, "lng": -9.1393},
    "bruselas": {"lat": 50.8503, "lng": 4.3517},
    "ámsterdam": {"lat": 52.3676, "lng": 4.9041},
    "viena": {"lat": 48.2082, "lng": 16.3738},
    "praga": {"lat": 50.0755, "lng": 14.4378},
    "varsovia": {"lat": 52.2297, "lng": 21.0122},
    "budapest": {"lat": 47.4979, "lng": 19.0402},
    "atenas": {"lat": 37.9838, "lng": 23.7275},
    "estambul": {"lat": 41.0082, "lng": 28.9784},
    "beirut": {"lat": 33.8886, "lng": 35.4955},
    "damasco": {"lat": 33.5138, "lng": 36.2765},
    "teherán": {"lat": 35.6892, "lng": 51.3890},
    "bagdad": {"lat": 33.3152, "lng": 44.3661},
    "el cairo": {"lat": 30.0444, "lng": 31.2357},
    "túnez": {"lat": 36.8065, "lng": 10.1815},
    "argel": {"lat": 36.7538, "lng": 3.0588},
    "rabat": {"lat": 34.0209, "lng": -6.8416},
    "nueva york": {"lat": 40.7128, "lng": -74.0060},
    "los ángeles": {"lat": 34.0522, "lng": -118.2437},
    "california": {"lat": 36.7783, "lng": -119.4179},
    "florida": {"lat": 27.6648, "lng": -81.5158},
    "texas": {"lat": 31.9686, "lng": -99.9018},
    "chicago": {"lat": 41.8781, "lng": -87.6298},
    "miami": {"lat": 25.7617, "lng": -80.1918},
    "houston": {"lat": 29.7604, "lng": -95.3698},
    "san francisco": {"lat": 37.7749, "lng": -122.4194},
    "boston": {"lat": 42.3601, "lng": -71.0589},
    "seattle": {"lat": 47.6062, "lng": -122.3321},
    "méxico": {"lat": 19.4326, "lng": -99.1332},
    "buenos aires": {"lat": -34.6037, "lng": -58.3816},
    "santiago": {"lat": -33.4489, "lng": -70.6693},
    "lima": {"lat": -12.0464, "lng": -77.0428},
    "bogotá": {"lat": 4.7110, "lng": -74.0721},
    "caracas": {"lat": 10.4806, "lng": -66.9036},
    "río de janeiro": {"lat": -22.9068, "lng": -43.1729},
    "são paulo": {"lat": -23.5505, "lng": -46.6333},
    "tokio": {"lat": 35.6762, "lng": 139.6503},
    "pekín": {"lat": 39.9042, "lng": 116.4074},
    "seúl": {"lat": 37.5665, "lng": 126.9780},
    "shanghái": {"lat": 31.2304, "lng": 121.4737},
    "hong kong": {"lat": 22.3193, "lng": 114.1694},
    "singapur": {"lat": 1.3521, "lng": 103.8198},
    "sídney": {"lat": -33.8688, "lng": 151.2093},
    "melbourne": {"lat": -37.8136, "lng": 144.9631},
}

def extract_location_from_text(title, content):
    """
    Extrae la ubicación más probable del título y contenido del artículo.
    Devuelve un dict con city, lat, lng o None si no encuentra nada.
    """
    # Combinar título y los primeros 500 caracteres del contenido
    text = (title + " " + (content[:500] if content else "")).lower()
    
    # Buscar ciudades en orden de prioridad (las más específicas primero)
    # Ordenamos por longitud de nombre para buscar "nueva york" antes que "york", etc.
    sorted_cities = sorted(SPANISH_CITIES.items(), key=lambda x: len(x[0]), reverse=True)
    
    for city_name, coords in sorted_cities:
        if city_name in text:
            return {
                "city": city_name.title(),
                "lat": coords["lat"],
                "lng": coords["lng"]
            }
    
    # Si no encuentra nada, devolver None
    return None
