<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prisma Aletheia - Noticias de España</title>

    <!-- Local Vendor Scripts -->
    <script src="./vendor/three.min.js"></script>
    <script src="./vendor/globe.gl.min.js"></script>
    <script src="./vendor/lucide.min.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }

        #globeViz {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }

        /* Left Panel */
        .panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(10, 10, 20, 0.85);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #333;
            max-width: 320px;
            backdrop-filter: blur(12px);
            z-index: 10;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .header h1 {
            margin: 0;
            font-size: 1.8em;
            color: #3eabf7;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .subtitle {
            margin: 5px 0 0;
            font-size: 0.9em;
            color: #aaa;
        }

        .date-picker {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .icon-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        #currentDate {
            font-weight: 500;
            font-size: 1.1em;
        }

        .news-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 50vh;
            overflow-y: auto;
        }

        .news-list h3 {
            font-size: 0.9em;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .news-list li {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.95em;
            line-height: 1.4;
            border-radius: 6px;
            margin-bottom: 5px;
        }

        .news-list li:hover {
            background: rgba(62, 171, 247, 0.15);
            border-left: 3px solid #3eabf7;
        }

        .news-list li:last-child {
            border-bottom: none;
        }

        .footer-links {
            margin-top: 20px;
            font-size: 0.8em;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 15px;
        }

        .footer-links a {
            color: #888;
            text-decoration: none;
            margin-right: 15px;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: #3eabf7;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Chatbot */
        .chatbot-container {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 20;
        }

        .chatbot-toggle {
            background: linear-gradient(135deg, #3eabf7, #0077cc);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(62, 171, 247, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .chatbot-toggle:hover {
            transform: scale(1.05);
        }

        .chatbot-window {
            display: none;
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            background: rgba(15, 15, 25, 0.95);
            border: 1px solid #333;
            border-radius: 16px;
            overflow: hidden;
            flex-direction: column;
            height: 500px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .chatbot-window.open {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-header {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .icon-btn-small {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            padding: 5px;
        }

        .icon-btn-small:hover {
            color: white;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 14px;
            border-radius: 12px;
            max-width: 85%;
            font-size: 0.95em;
            line-height: 1.4;
        }

        .message.bot {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .message.user {
            background: #3eabf7;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .message p {
            margin: 0;
        }

        .chat-input-area {
            padding: 15px;
            display: flex;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            gap: 10px;
        }

        .chat-input-area input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 10px;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input-area input:focus {
            border-color: #3eabf7;
        }

        .chat-input-area button {
            background: #3eabf7;
            border: none;
            color: white;
            padding: 0 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-input-area button:hover {
            background: #2d9cdb;
        }
    </style>
</head>

<body>
    <!-- Globe Container -->
    <div id="globeViz"></div>

    <!-- Left Panel -->
    <div class="panel left-panel">
        <div class="header">
            <h1>Noticias de España</h1>
            <p class="subtitle">Visualización en tiempo real</p>
        </div>

        <div class="date-picker">
            <button class="icon-btn"><i data-lucide="chevron-left"></i></button>
            <span id="currentDate">29 Jun 2025</span>
            <button class="icon-btn"><i data-lucide="chevron-right"></i></button>
        </div>

        <div class="news-list">
            <h3>Titulares Destacados</h3>
            <ul id="topNews">
                <!-- Populated by JS -->
            </ul>
        </div>

        <div class="footer-links">
            <a href="#">Sobre nosotros</a>
            <a href="#">Fuentes</a>
        </div>
    </div>

    <!-- Chatbot Interface -->
    <div class="chatbot-container">
        <button id="chatbotToggle" class="chatbot-toggle">
            <i data-lucide="message-circle"></i>
        </button>

        <div class="chatbot-window" id="chatbotWindow">
            <div class="chat-header">
                <div class="chat-title">
                    <i data-lucide="bot"></i>
                    <span>Asistente IA</span>
                </div>
                <button id="chatbotClose" class="icon-btn-small"><i data-lucide="x"></i></button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <p>Hola. Soy tu asistente de noticias. ¿En qué puedo ayudarte hoy?</p>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Escribe un mensaje...">
                <button id="chatSend"><i data-lucide="send"></i></button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data for Spanish News
        // News Data provided by User (2025-06-29)
        const newsData = [
            {
                city: "Madrid",
                lat: 40.4168,
                lng: -3.7038,
                title: "Las seis vidas segadas en una semana dramática de violencia machista",
                summary: "Entre el martes y el miércoles fueron hallados los cuerpos de cinco mujeres asesinadas a manos de sus parejas...",
                source: "El País",
                url: "https://elpais.com/sociedad/2025-06-28/las-seis-vidas-segadas-en-una-semana-dramatica-de-violencia-machista.html"
            },
            {
                city: "Almería",
                lat: 36.8340,
                lng: -2.4637,
                title: "Detenido un hombre por el asesinato de su mujer en Almería",
                summary: "La Policía Nacional ha detenido a un hombre de 60 años como presunto asesino de su mujer...",
                source: "El País",
                url: "https://elpais.com/espana/2025-06-28/detenido-un-hombre-por-el-asesinato-de-su-mujer-en-almeria.html"
            },
            {
                city: "Madrid (Tribunal Supremo)",
                lat: 40.4240,
                lng: -3.6938,
                title: "Protesta de jueces y fiscales contra la reforma judicial",
                summary: "Cientos de manifestantes en la protesta de jueces y fiscales contra la reforma judicial del Gobierno...",
                source: "El País",
                url: "https://elpais.com/espana/2025-06-28/multitudinaria-protesta-de-jueces-y-fiscales-contra-la-reforma-judicial-al-supremo.html"
            },
            {
                city: "Sevilla",
                lat: 37.3891,
                lng: -5.9845,
                title: "Arranca la primera ola de calor",
                summary: "La primera ola de calor arranca con el 77% de los municipios en niveles de riesgo para la salud...",
                source: "El País",
                url: "https://elpais.com/clima-y-medio-ambiente/2025-06-28/la-primera-ola-de-calor-arranca-con-el-75-de-los-municipios-en-niveles-de-riesgo-para-la-salud.html"
            },
            {
                city: "Budapest",
                lat: 47.4979,
                lng: 19.0402,
                title: "Claves del Orgullo prohibido en Budapest",
                summary: "Hungría celebra hoy su manifestación por los derechos LGTBIQ+ más compleja en un ambiente de alta tensión...",
                source: "El País",
                url: "https://elpais.com/sociedad/lgtb/2025-06-28/claves-del-orgullo-prohibido-de-budapest.html"
            },
            {
                city: "Madrid (Zarzuela)",
                lat: 40.4820,
                lng: -3.7964,
                title: "Marta Carazo, nueva jefa de la Secretaría de la Reina",
                summary: "La periodista de TVE será la nueva mano derecha de la Reina Letizia a partir de septiembre...",
                source: "El País",
                url: "https://elpais.com/espana/2025-06-28/marta-carazo-periodista-de-tve-nueva-jefa-de-la-secretaria-de-la-reina.html"
            },
            {
                city: "Madrid (Congreso)",
                lat: 40.4160,
                lng: -3.6960,
                title: "Trump, Peinado y González, ¿al rescate de Sánchez?",
                summary: "Análisis sobre cómo los recientes eventos internacionales y judiciales afectan al presidente Pedro Sánchez...",
                source: "El País",
                url: "https://elpais.com/espana/2025-06-28/trump-peinado-y-gonzalez-al-rescate-de-sanchez.html"
            },
            {
                city: "Venecia",
                lat: 45.4408,
                lng: 12.3155,
                title: "Boda de Jeff Bezos y Lauren Sánchez en Venecia",
                summary: "Fin de fiesta con baile de máscaras y manifestación contra la boda en la ciudad italiana...",
                source: "El País",
                url: "https://elpais.com/gente/2025-06-28/fin-de-fiesta-de-jeff-bezos-y-lauren-sanchez-en-venecia-baile-de-mascaras-y-manifestacion-contra-la-boda.html"
            },
            {
                city: "California (Western States)",
                lat: 39.0968,
                lng: -120.0324,
                title: "Kilian Jornet: 'Hay momentos en que no sé si estoy vivo o muerto'",
                summary: "El atleta regresa a la carrera Western States de 100 millas en California...",
                source: "El País",
                url: "https://elpais.com/deportes/2025-06-28/kilian-jornet-hay-momentos-en-que-no-se-si-estoy-vivo-o-muerto.html"
            },
            {
                city: "Valencia",
                lat: 39.4699,
                lng: -0.3763,
                title: "El auge del ventilador de techo",
                summary: "Por qué el ventilador de techo amenaza el reinado del aire acondicionado este verano...",
                source: "El País",
                url: "https://elpais.com/economia/negocios/2025-06-28/el-gran-hit-del-verano-contra-el-calor-por-que-el-ventilador-de-techo-amenaza-el-reinado-del-aire-acondicionado.html"
            },
            {
                city: "Teherán",
                lat: 35.6892,
                lng: 51.3890,
                title: "Funerales multitudinarios en Irán",
                summary: "Irán cierra filas con un funeral de Estado por los altos cargos asesinados en el conflicto...",
                source: "El País",
                url: "https://elpais.com/internacional/2025-06-28/iran-cierra-filas-con-los-funerales-por-los-altos-cargos-asesinados-por-israel.html"
            },
            {
                city: "Gaza",
                lat: 31.5017,
                lng: 34.4668,
                title: "Conflicto en Oriente Próximo: Última hora",
                summary: "Israel mata al menos a 12 palestinos en Gaza mientras continúan los funerales en Irán...",
                source: "El País",
                url: "https://elpais.com/internacional/2025-06-28/ultima-hora-del-conflicto-en-oriente-proximo-en-directo.html"
            },
            {
                city: "Washington D.C.",
                lat: 38.9072,
                lng: -77.0369,
                title: "El Supremo de EE UU limita el poder de los jueces",
                summary: "Victoria para Trump: el tribunal limita la capacidad de los jueces para bloquear su agenda...",
                source: "El País",
                url: "https://elpais.com/internacional/2025-06-27/el-supremo-de-ee-uu-limita-el-poder-de-los-jueces-para-oponerse-a-la-agenda-de-trump.html"
            },
            background: #3eabf7;
        border: none;
        color: white;
        padding: 0 15px;
        border - radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        display: flex;
        align - items: center;
        justify - content: center;
        }

        .chat - input - area button:hover {
            background: #2d9cdb;
        }
    </style >
</head >

            <body>
    <!-- Globe Container -->
                <div id="globeViz"></div>

                <!-- Left Panel -->
                <div class="panel left-panel">
                    <div class="header">
                        <h1>Noticias de España</h1>
                        <p class="subtitle">Visualización en tiempo real</p>
                    </div>

                    <div class="date-picker">
                        <button class="icon-btn"><i data-lucide="chevron-left"></i></button>
                        <span id="currentDate">29 Jun 2025</span>
                        <button class="icon-btn"><i data-lucide="chevron-right"></i></button>
                    </div>

                    <div class="news-list">
                        <h3>Titulares Destacados</h3>
                        <ul id="topNews">
                            <!-- Populated by JS -->
                        </ul>
                    </div>

                    <div class="footer-links">
                        <a href="#">Sobre nosotros</a>
                        <a href="#">Fuentes</a>
                    </div>
                </div>

                <!-- Chatbot Interface -->
                <div class="chatbot-container">
                    <button id="chatbotToggle" class="chatbot-toggle">
                        <i data-lucide="message-circle"></i>
                    </button>

                    <div class="chatbot-window" id="chatbotWindow">
                        <div class="chat-header">
                            <div class="chat-title">
                                <i data-lucide="bot"></i>
                                <span>Asistente IA</span>
                            </div>
                            <button id="chatbotClose" class="icon-btn-small"><i data-lucide="x"></i></button>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="message bot">
                                <p>Hola. Soy tu asistente de noticias. ¿En qué puedo ayudarte hoy?</p>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="chatInput" placeholder="Escribe un mensaje...">
                                <button id="chatSend"><i data-lucide="send"></i></button>
                        </div>
                    </div>
                </div>

                <script>
        // Mock Data for Spanish News
                    // News Data provided by User (2025-06-29)
                    const newsData = [
                    {
                        city: "Madrid",
                    lat: 40.4168,
                    lng: -3.7038,
                    title: "Las seis vidas segadas en una semana dramática de violencia machista",
                    summary: "Entre el martes y el miércoles fueron hallados los cuerpos de cinco mujeres asesinadas a manos de sus parejas...",
                    source: "El País",
                    url: "https://elpais.com/sociedad/2025-06-28/las-seis-vidas-segadas-en-una-semana-dramatica-de-violencia-machista.html"
            },
                    {
                        city: "Almería",
                    lat: 36.8340,
                    lng: -2.4637,
                    title: "Detenido un hombre por el asesinato de su mujer en Almería",
                    summary: "La Policía Nacional ha detenido a un hombre de 60 años como presunto asesino de su mujer...",
                    source: "El País",
                    url: "https://elpais.com/espana/2025-06-28/detenido-un-hombre-por-el-asesinato-de-su-mujer-en-almeria.html"
            },
                    {
                        city: "Madrid (Tribunal Supremo)",
                    lat: 40.4240,
                    lng: -3.6938,
                    title: "Protesta de jueces y fiscales contra la reforma judicial",
                    summary: "Cientos de manifestantes en la protesta de jueces y fiscales contra la reforma judicial del Gobierno...",
                    source: "El País",
                    url: "https://elpais.com/espana/2025-06-28/multitudinaria-protesta-de-jueces-y-fiscales-contra-la-reforma-judicial-al-supremo.html"
            },
                    {
                        city: "Sevilla",
                    lat: 37.3891,
                    lng: -5.9845,
                    title: "Arranca la primera ola de calor",
                    summary: "La primera ola de calor arranca con el 77% de los municipios en niveles de riesgo para la salud...",
                    source: "El País",
                    url: "https://elpais.com/clima-y-medio-ambiente/2025-06-28/la-primera-ola-de-calor-arranca-con-el-75-de-los-municipios-en-niveles-de-riesgo-para-la-salud.html"
            },
                    {
                        city: "Budapest",
                    lat: 47.4979,
                    lng: 19.0402,
                    title: "Claves del Orgullo prohibido en Budapest",
                    summary: "Hungría celebra hoy su manifestación por los derechos LGTBIQ+ más compleja en un ambiente de alta tensión...",
                    source: "El País",
                    url: "https://elpais.com/sociedad/lgtb/2025-06-28/claves-del-orgullo-prohibido-de-budapest.html"
            },
                    {
                        city: "Madrid (Zarzuela)",
                    lat: 40.4820,
                    lng: -3.7964,
                    title: "Marta Carazo, nueva jefa de la Secretaría de la Reina",
                    summary: "La periodista de TVE será la nueva mano derecha de la Reina Letizia a partir de septiembre...",
                    source: "El País",
                    url: "https://elpais.com/espana/2025-06-28/marta-carazo-periodista-de-tve-nueva-jefa-de-la-secretaria-de-la-reina.html"
            },
                    {
                        city: "Madrid (Congreso)",
                    lat: 40.4160,
                    lng: -3.6960,
                    title: "Trump, Peinado y González, ¿al rescate de Sánchez?",
                    summary: "Análisis sobre cómo los recientes eventos internacionales y judiciales afectan al presidente Pedro Sánchez...",
                    source: "El País",
                    url: "https://elpais.com/espana/2025-06-28/trump-peinado-y-gonzalez-al-rescate-de-sanchez.html"
            },
                    {
                        city: "Venecia",
                    lat: 45.4408,
                    lng: 12.3155,
                    title: "Boda de Jeff Bezos y Lauren Sánchez en Venecia",
                    summary: "Fin de fiesta con baile de máscaras y manifestación contra la boda en la ciudad italiana...",
                    source: "El País",
                    url: "https://elpais.com/gente/2025-06-28/fin-de-fiesta-de-jeff-bezos-y-lauren-sanchez-en-venecia-baile-de-mascaras-y-manifestacion-contra-la-boda.html"
            },
                    {
                        city: "California (Western States)",
                    lat: 39.0968,
                    lng: -120.0324,
                    title: "Kilian Jornet: 'Hay momentos en que no sé si estoy vivo o muerto'",
                    summary: "El atleta regresa a la carrera Western States de 100 millas en California...",
                    source: "El País",
                    url: "https://elpais.com/deportes/2025-06-28/kilian-jornet-hay-momentos-en-que-no-se-si-estoy-vivo-o-muerto.html"
            },
                    {
                        city: "Valencia",
                    lat: 39.4699,
                    lng: -0.3763,
                    title: "El auge del ventilador de techo",
                    summary: "Por qué el ventilador de techo amenaza el reinado del aire acondicionado este verano...",
                    source: "El País",
                    url: "https://elpais.com/economia/negocios/2025-06-28/el-gran-hit-del-verano-contra-el-calor-por-que-el-ventilador-de-techo-amenaza-el-reinado-del-aire-acondicionado.html"
            },
                    {
                        city: "Teherán",
                    lat: 35.6892,
                    lng: 51.3890,
                    title: "Funerales multitudinarios en Irán",
                    summary: "Irán cierra filas con un funeral de Estado por los altos cargos asesinados en el conflicto...",
                    source: "El País",
                    url: "https://elpais.com/internacional/2025-06-28/iran-cierra-filas-con-los-funerales-por-los-altos-cargos-asesinados-por-israel.html"
            },
                    {
                        city: "Gaza",
                    lat: 31.5017,
                    lng: 34.4668,
                    title: "Conflicto en Oriente Próximo: Última hora",
                    summary: "Israel mata al menos a 12 palestinos en Gaza mientras continúan los funerales en Irán...",
                    source: "El País",
                    url: "https://elpais.com/internacional/2025-06-28/ultima-hora-del-conflicto-en-oriente-proximo-en-directo.html"
            },
                    {
                        city: "Washington D.C.",
                    lat: 38.9072,
                    lng: -77.0369,
                    title: "El Supremo de EE UU limita el poder de los jueces",
                    summary: "Victoria para Trump: el tribunal limita la capacidad de los jueces para bloquear su agenda...",
                    source: "El País",
                    url: "https://elpais.com/internacional/2025-06-27/el-supremo-de-ee-uu-limita-el-poder-de-los-jueces-para-oponerse-a-la-agenda-de-trump.html"
            },
                    {
                        city: "Lavapiés (Madrid)",
                    lat: 40.4087,
                    lng: -3.7005,
                    title: "El camino imposible de los inmigrantes sin papeles",
                    summary: "Años en la clandestinidad: historias de supervivencia de inmigrantes irregulares en España...",
                    source: "El País",
                    url: "https://elpais.com/espana/2025-06-28/anos-en-la-clandestinidad-el-camino-imposible-de-los-inmigrantes-sin-papeles-en-espana.html"
            }
                    ];

                    // Initialize Globe variable
                    let world;

                    // Populate Left Panel News List
                    const newsList = document.getElementById('topNews');
        newsData.forEach(item => {
            const li = document.createElement('li');
                    li.textContent = item.title;
                    li.title = item.summary;
            li.onclick = () => {
                // Fly to location on click
                if (world) {
                        world.pointOfView({ lat: item.lat, lng: item.lng, altitude: 1.5 }, 2000);
                    world.controls().autoRotate = false; // Stop rotation to focus
                }
            };
                    newsList.appendChild(li);
        });

                    // Constants for clouds
                    const CLOUDS_ALT = 0.004;
                    const CLOUDS_ROTATION_SPEED = 0.005;

        window.addEventListener('load', () => {
            if (!window.THREE || typeof Globe === 'undefined') {
                        console.error("Missing dependencies");
                    return;
            }

                    // Load Textures
                    const textureLoader = new THREE.TextureLoader();
                    const dayTexture = textureLoader.load('./img/earth-blue-marble.jpg');
                    const nightTexture = textureLoader.load('./img/earth-night.jpg');
                    const cloudTexture = textureLoader.load('./img/earth-clouds.png');

                    // Sun Direction (World Space)
                    const sunDir = new THREE.Vector3(-1, 0.5, 1.5).normalize();

                    // Custom Earth Shader Material
                    const earthMaterial = new THREE.ShaderMaterial({
                        uniforms: {
                        dayTexture: {value: dayTexture },
                    nightTexture: {value: nightTexture },
                    sunDirection: {value: sunDir }
                },
                    vertexShader: `
                    varying vec2 vUv;
                    varying vec3 vNormal;
                    void main() {
                        vUv = uv;
                    vNormal = normalize(mat3(modelMatrix) * normal);
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                    `,
                    fragmentShader: `
                    uniform sampler2D dayTexture;
                    uniform sampler2D nightTexture;
                    uniform vec3 sunDirection;
                    varying vec2 vUv;
                    varying vec3 vNormal;

                    void main() {
                        vec3 dayColor = texture2D(dayTexture, vUv).rgb;
                    vec3 nightColor = texture2D(nightTexture, vUv).rgb;
                    float intensity = dot(vNormal, sunDirection);
                    float mixFactor = smoothstep(-0.1, 0.1, intensity);
                    vec3 finalColor = mix(nightColor, dayColor, mixFactor);
                    gl_FragColor = vec4(finalColor, 1.0);
                    }
                    `
            });

                    // Initialize Globe
                    world = Globe()
                    (document.getElementById('globeViz'))
                    .globeMaterial(earthMaterial)
                    .backgroundImageUrl('./img/night-sky.png')
                    .pointOfView({lat: 40.4168, lng: -3.7038, altitude: 1.5 })
                    .pointsData(newsData)
                    .pointLat('lat')
                    .pointLng('lng')
                .pointColor(() => '#3eabf7')
                    .pointAltitude(0.1)
                    .pointRadius(0.5)
                    .showAtmosphere(true)
                    .atmosphereColor('lightskyblue')
                    .atmosphereAltitude(0.15)
                .pointLabel(d => `
                    <div style="background: rgba(0,0,0,0.8); padding: 8px; border-radius: 4px; border: 1px solid #3eabf7; color: white; font-family: sans-serif;">
                        <b style="color: #3eabf7">${d.city}</b>: ${d.title}<br />
                        <i style="font-size: 0.8em; color: #ccc">${d.source}</i>
                    </div>
                    `)
                .onPointClick(d => {
                    if (d.url) window.open(d.url, '_blank');
                });

                    // Add Clouds
                    const clouds = new THREE.Mesh(
                    new THREE.SphereGeometry(world.getGlobeRadius() * (1 + CLOUDS_ALT), 75, 75),
                    new THREE.MeshPhongMaterial({
                        map: cloudTexture,
                    transparent: true,
                    opacity: 0.9,
                    side: THREE.DoubleSide
                })
                    );
                    world.scene().add(clouds);

                    // Lighting
                    const scene = world.scene();
                    const ambientLight = new THREE.AmbientLight(0xbbbbbb, 0.3);
                    scene.add(ambientLight);

                    const sunLight = new THREE.DirectionalLight(0xffffff, 2.0);
                    sunLight.position.copy(sunDir);
                    scene.add(sunLight);

                    // Animation Loop
                    (function animate() {
                        clouds.rotation.y += CLOUDS_ROTATION_SPEED * Math.PI / 180;
                    requestAnimationFrame(animate);
            })();

                    // Initialize Icons
                    lucide.createIcons();
        });

                    const chatbotClose = document.getElementById('chatbotClose');
                    const chatbotToggle = document.getElementById('chatbotToggle');
                    const chatbotWindow = document.getElementById('chatbotWindow');
                    const chatInput = document.getElementById('chatInput');
                    const chatSend = document.getElementById('chatSend');
                    const chatMessages = document.getElementById('chatMessages');

                    function toggleChat() {
                        chatbotWindow.classList.toggle('open');
        }

                    chatbotToggle.addEventListener('click', toggleChat);
                    chatbotClose.addEventListener('click', toggleChat);

                    function addMessage(text, sender) {
            const div = document.createElement('div');
                    div.classList.add('message', sender);
                    div.innerHTML = `<p>${text}</p>`;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleSend() {
            const text = chatInput.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            chatInput.value = '';

            // Simulate bot response
            setTimeout(() => {
                const responses = [
                    "Entiendo. ¿Te gustaría saber más sobre esa noticia?",
                    "Puedo buscar más información en los periódicos españoles.",
                    "Ese es un tema interesante. Aquí tienes un resumen...",
                    "Lo siento, solo soy una interfaz de demostración por ahora."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(randomResponse, 'bot');
            }, 1000);
        }

        chatSend.addEventListener('click', handleSend);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSend();
        });
    </script>
</body>

</html>